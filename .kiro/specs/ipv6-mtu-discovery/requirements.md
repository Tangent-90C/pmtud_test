# 需求文档

## 简介

本文档规定了IPv6最小MTU探测工具的需求，该工具能够探测并确定到目标地址的IPv6数据包的最小最大传输单元（MTU）大小。该工具将使用不同载荷大小的ICMP6数据包来发现路径MTU，并识别网络路径上支持的最小MTU。

## 术语表

- **MTU探测工具**: 执行路径MTU检测的IPv6 MTU发现应用程序
- **目标IPv6地址**: 用于MTU探测的目标IPv6地址
- **ICMP6数据包**: 用于探测的Internet控制消息协议版本6数据包
- **路径MTU**: 到目标地址的整个网络路径上支持的最小MTU大小
- **探测数据包**: 具有特定载荷大小的ICMP6数据包，用于MTU测试
- **分片需要响应**: 表示MTU超出的ICMPv6"数据包过大"消息
- **二分搜索算法**: 用于高效查找最大MTU大小的方法
- **Root权限**: 执行原始套接字操作所需的管理系统访问权限
- **PMTUD**: 路径MTU发现协议，用于自动发现网络路径的MTU
- **PMTUD回包**: 包含中间路由器MTU信息的ICMPv6响应消息
- **TCP_MSS钳制**: TCP最大段大小钳制功能，限制TCP连接的MSS值
- **客户端模式**: 作为TCP客户端进行MSS钳制检测的工作模式
- **服务端模式**: 作为TCP服务端进行MSS钳制检测的工作模式
- **MSS篡改检测**: 检测网络中间设备是否修改了TCP握手过程中的MSS选项值
- **MSS协商验证**: 验证客户端发送的MSS值与服务端接收的MSS值是否一致
- **控制端口**: 用于客户端与服务端进行MSS验证信息交换的专用通信端口
- **MSS完整性检查**: 确保TCP MSS选项在网络传输过程中未被篡改的验证机制

## 需求

### 需求1

**用户故事：** 作为网络管理员，我希望输入IPv6地址并发现路径上的最小MTU，以便优化网络配置并排除连接问题。

#### 验收标准

1. 当用户提供有效的IPv6地址作为输入时，MTU探测工具应接受该地址进行处理
2. MTU探测工具应验证输入是否为格式正确的IPv6地址
3. 如果提供了无效的IPv6地址，则MTU探测工具应显示错误消息并请求有效输入
4. MTU探测工具应需要root权限来执行原始套接字操作
5. 如果检测到权限不足，则MTU探测工具应显示适当的错误消息并退出

### 需求2

**用户故事：** 作为网络工程师，我希望工具系统地探测不同的MTU大小，以便准确确定支持的最大数据包大小。

#### 验收标准

1. MTU探测工具应创建具有不同载荷大小的ICMP6数据包进行探测
2. MTU探测工具应实现二分搜索算法以高效查找路径MTU
3. 当发送探测数据包时，MTU探测工具应为IPv6设置"不分片"等效行为
4. MTU探测工具应从最大1500字节和最小68字节开始探测
5. 当收到分片需要响应时，MTU探测工具应相应调整探测大小
6. MTU探测工具应检测和解析PMTUD回包中携带的中间路由器MTU数值
7. 当收到PMTUD回包时，MTU探测工具应显示中间路由器报告的MTU信息

### 需求3

**用户故事：** 作为系统管理员，我希望清楚地看到MTU发现过程和结果显示，以便了解网络路径特征。

#### 验收标准

1. MTU探测工具应在发现过程中显示当前正在测试的探测大小
2. 当成功确定路径MTU时，MTU探测工具应显示最终MTU值
3. MTU探测工具应显示发现过程中进行的探测尝试次数
4. 如果目标不可达，则MTU探测工具应显示适当的错误消息
5. MTU探测工具应在30秒内完成发现过程或报告超时

### 需求4

**用户故事：** 作为网络故障排除人员，我希望工具能够简单有效地检测IPv6不可达性，以便快速判断目标是否可达。

#### 验收标准

1. 当MTU探测过程中没有收到任何echo报文时，MTU探测工具应判定目标为不可达
2. MTU探测工具应在探测开始时发送初始探测包验证基本连通性
3. 如果初始探测包没有收到echo回复，则MTU探测工具应立即报告目标不可达
4. MTU探测工具应提供简洁明确的不可达状态报告
5. 不可达检测应该简单直接，避免复杂的模式分析和多重验证

### 需求5

**用户故事：** 作为网络管理员，我希望检测TCP MSS钳制功能，以便了解网络设备对TCP连接的MSS限制情况和验证客户端与服务端MSS协商的一致性。

#### 验收标准

1. MTU探测工具应支持客户端模式进行TCP_MSS钳制检测
2. MTU探测工具应支持服务端模式进行TCP_MSS钳制检测
3. 客户端模式和服务端模式应使用同一套代码实现
4. 当检测到MSS钳制时，MTU探测工具应报告被钳制的MSS值
5. MTU探测工具应显示原始MSS值和被钳制后的MSS值的对比

### 需求6

**用户故事：** 作为网络安全工程师，我希望验证TCP MSS协商的完整性，以便检测网络中间设备是否篡改了MSS值，确保客户端发送的MSS与服务端接收的MSS保持一致。

#### 验收标准

1. 当客户端故意使用较大MSS值与服务端握手时，MTU探测工具应记录客户端发送的原始MSS值
2. MTU探测工具应在服务端检测并记录从客户端接收到的实际MSS值
3. MTU探测工具应比较客户端发送的MSS值与服务端接收的MSS值
4. 如果发现MSS值不一致，则MTU探测工具应报告MSS篡改检测结果
5. MTU探测工具应显示MSS篡改的详细信息，包括原始值、接收值和差异
6. 客户端与服务端应能够提前建立通信连接以交换MSS验证信息
7. MTU探测工具应支持指定用于MSS验证通信的控制端口